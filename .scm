{"latest": {"/home/user/tmp/scmpy/scm.py": ["#!/usr/bin/env python3", "", "import os, sys, json, subprocess, difflib", "", "# diff helper", "diff_lines = lambda ls_0, ls_1: \"\".join(", "    [line for line in difflib.unified_diff(ls_0, ls_1)]", ")", "", "# saves current version to .scm", "def commit():", "    # Get all files that aren't hidden", "    tree = [node for node in os.walk(os.getcwd()) if \".\" not in node[0]]", "    fs = [os.path.join(node[0], n) for node in tree for n in node[2] if n[0] != \".\"]", "", "    # Get or create .scm file", "    if not os.path.isfile(\".scm\") or os.path.getsize(\".scm\") == 0:", "        # create", "        latest = {f: open(f).read().splitlines() for f in fs}", "        json.dump(", "            {\"latest\": latest, \"commit\": [{\"init\": latest, \"diff\": {}}]},", "            open(\".scm\", \"w\"),", "        )", "    else:", "        # get", "        scm = json.loads(open(\".scm\", \"r\").read())", "        late = scm[\"latest\"]", "        curr = scm[\"commit\"]", "        old_fs = [f for f in curr[-1][\"init\"]] + [f for f in curr[-1][\"diff\"]]", "        new_fs = [f for f in fs if fs not in old_fs]", "        init = {f: open(f).read().splitlines() for f in new_fs if f not in old_fs}", "        # We use unified diff from difflib since it still works with patch.", "        diff = {f: diff_lines(late[f], open(f).read().splitlines()) for f in old_fs}", "        scm[\"latest\"] = {f: open(f).read().splitlines() for f in fs}", "        scm[\"commit\"].append({\"init\": init, \"diff\": diff})", "        json.dump(scm, open(\".scm\", \"w\"))", "", "", "# pops latest without caching.", "# not gonna ether novel files, that seems pointless?", "def scrape():", "    (not os.path.isfile(\".scm\") or os.path.getsize(\".scm\") == 0) and exit()", "    [", "        open(k, \"w\").write(\"\\n\".join(v))", "        for k, v in json.loads(open(\".scm\", \"r\").read())[\"latest\"].items()", "    ]", "", "", "def revert():", "    # let's just roll back one, that's logically equivalent", "    # scrape()", "    print(\"what up\")", "", "", "def main():", "    args = sys.argv", "    len(args) == 2 and {\"commit\": commit, \"scrape\": scrape, \"revert\": revert}[args[1]]()", "", "", "if __name__ == \"__main__\":", "    main()"]}, "commit": [{"init": {"/home/user/tmp/scmpy/scm.py": ["import os, sys, json, subprocess, difflib", "", "# diff helper", "diff_lines = lambda ls_0, ls_1: \"\".join([line for line in difflib.unified_diff(ls_0, ls_1)])", "", "# Get all files that aren't hidden", "tree = [node for node in os.walk(os.getcwd()) if \".\" not in node[0]]", "fs = [os.path.join(node[0],n) for node in tree for n in node[2] if n[0] != \".\"]   ", "", "# Get or create .scm file", "if not os.path.isfile(\".scm\") or os.path.getsize(\".scm\") == 0:", "    # create", "    latest = {f:open(f).read().splitlines() for f in fs}", "    json.dump({\"latest\": latest, \"commit\":[{\"init\":latest, \"diff\":{}}]}, open(\".scm\", \"w\"))", "else:", "    # get", "    scm = json.loads(open(\".scm\",\"r\").read())", "    late = scm[\"latest\"]", "    curr = scm[\"commit\"]", "    old_fs = [f for f in curr[-1][\"init\"]] + [f for f in curr[-1][\"diff\"]]", "    new_fs = [f for f in fs if fs not in old_fs]", "    init = {f:open(f).read().splitlines() for f in new_fs if f not in old_fs}", "    # We use unified diff from difflib since it still works with patch.", "    diff = {f:diff_lines(late[f],open(f).read().splitlines()) for f in old_fs}", "    scm[\"latest\"] = {f:open(f).read().splitlines() for f in fs}", "    scm[\"commit\"].append({\"init\":init,\"diff\":diff})", "    json.dump(scm, open(\".scm\",\"w\"))"]}, "diff": {}}, {"init": {}, "diff": {"/home/user/tmp/scmpy/scm.py": "--- \n+++ \n@@ -25,3 +25,5 @@\n     scm[\"latest\"] = {f:open(f).read().splitlines() for f in fs}     scm[\"commit\"].append({\"init\":init,\"diff\":diff})     json.dump(scm, open(\".scm\",\"w\"))+    +# Trivial comment"}}, {"init": {}, "diff": {"/home/user/tmp/scmpy/scm.py": "--- \n+++ \n@@ -1,29 +1,61 @@\n+#!/usr/bin/env python3+ import os, sys, json, subprocess, difflib  # diff helper-diff_lines = lambda ls_0, ls_1: \"\".join([line for line in difflib.unified_diff(ls_0, ls_1)])+diff_lines = lambda ls_0, ls_1: \"\".join(+    [line for line in difflib.unified_diff(ls_0, ls_1)]+) -# Get all files that aren't hidden-tree = [node for node in os.walk(os.getcwd()) if \".\" not in node[0]]-fs = [os.path.join(node[0],n) for node in tree for n in node[2] if n[0] != \".\"]   +# saves current version to .scm+def commit():+    # Get all files that aren't hidden+    tree = [node for node in os.walk(os.getcwd()) if \".\" not in node[0]]+    fs = [os.path.join(node[0], n) for node in tree for n in node[2] if n[0] != \".\"] -# Get or create .scm file-if not os.path.isfile(\".scm\") or os.path.getsize(\".scm\") == 0:-    # create-    latest = {f:open(f).read().splitlines() for f in fs}-    json.dump({\"latest\": latest, \"commit\":[{\"init\":latest, \"diff\":{}}]}, open(\".scm\", \"w\"))-else:-    # get-    scm = json.loads(open(\".scm\",\"r\").read())-    late = scm[\"latest\"]-    curr = scm[\"commit\"]-    old_fs = [f for f in curr[-1][\"init\"]] + [f for f in curr[-1][\"diff\"]]-    new_fs = [f for f in fs if fs not in old_fs]-    init = {f:open(f).read().splitlines() for f in new_fs if f not in old_fs}-    # We use unified diff from difflib since it still works with patch.-    diff = {f:diff_lines(late[f],open(f).read().splitlines()) for f in old_fs}-    scm[\"latest\"] = {f:open(f).read().splitlines() for f in fs}-    scm[\"commit\"].append({\"init\":init,\"diff\":diff})-    json.dump(scm, open(\".scm\",\"w\"))-    -# Trivial comment+    # Get or create .scm file+    if not os.path.isfile(\".scm\") or os.path.getsize(\".scm\") == 0:+        # create+        latest = {f: open(f).read().splitlines() for f in fs}+        json.dump(+            {\"latest\": latest, \"commit\": [{\"init\": latest, \"diff\": {}}]},+            open(\".scm\", \"w\"),+        )+    else:+        # get+        scm = json.loads(open(\".scm\", \"r\").read())+        late = scm[\"latest\"]+        curr = scm[\"commit\"]+        old_fs = [f for f in curr[-1][\"init\"]] + [f for f in curr[-1][\"diff\"]]+        new_fs = [f for f in fs if fs not in old_fs]+        init = {f: open(f).read().splitlines() for f in new_fs if f not in old_fs}+        # We use unified diff from difflib since it still works with patch.+        diff = {f: diff_lines(late[f], open(f).read().splitlines()) for f in old_fs}+        scm[\"latest\"] = {f: open(f).read().splitlines() for f in fs}+        scm[\"commit\"].append({\"init\": init, \"diff\": diff})+        json.dump(scm, open(\".scm\", \"w\"))+++# pops latest without caching.+# not gonna ether novel files, that seems pointless?+def scrape():+    (not os.path.isfile(\".scm\") or os.path.getsize(\".scm\") == 0) and exit()+    [+        open(k, \"w\").writelines(v)+        for k, v in json.loads(open(\".scm\", \"r\").read())[\"latest\"].items()+    ]+++def revert():+    # let's just roll back one, that's logically equivalent+    # scrape()+    print(\"what up\")+++def main():+    args = sys.argv+    len(args) == 2 and {\"commit\": commit, \"scrape\": scrape, \"revert\": revert}[args[1]]()+++if __name__ == \"__main__\":+    main()"}}, {"init": {}, "diff": {"/home/user/tmp/scmpy/scm.py": "--- \n+++ \n@@ -41,7 +41,7 @@\n def scrape():     (not os.path.isfile(\".scm\") or os.path.getsize(\".scm\") == 0) and exit()     [-        open(k, \"w\").writelines(v)+        open(k, \"w\").write(\"\\n\".join(v))         for k, v in json.loads(open(\".scm\", \"r\").read())[\"latest\"].items()     ] "}}]}